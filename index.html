<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TOM-LC CKT — Online Simulation</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; line-height: 1.45; }
    header { margin-bottom: 12px; }
    h1 { margin: 0 0 8px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; box-shadow: 0 1px 6px rgba(0,0,0,0.06); }
    textarea { width: 100%; height: 360px; font-family: monospace; font-size: 13px; border-radius: 8px; padding: 12px; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #999; background:#f7f7f7; cursor: pointer; }
    button.primary { background: #0d6efd; color: white; border-color: #0d6efd; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 8px; }
    .muted { color: #666; font-size: 14px; }
    code { background: #f2f2f2; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <header>
    <h1>TOM-LC CKT — 1 kV Series-Resonant Driver (Online)</h1>
    <p class="muted">
      This page lets you simulate the <b>1 kV Variable-Frequency Series-Resonant Driver</b>
      directly in your browser. Best tested with
      <a href="https://shishir-dey.github.io/ngspiceX/" target="_blank" rel="noopener">ngspiceX</a>.
    </p>
  </header>

  <section class="card">
    <h2>Netlist Preview</h2>
    <textarea id="netlist" readonly>
* Variable Frequency Series Resonant Driver - 1 kV
* Professional Circuit Design for High Voltage Applications
* Date: October 14, 2025
* Description: Variable frequency series-resonant tank driver with MOSFET switching
* Frequency Range: 300 kHz – 380 kHz (sweepable)
* Resonant Frequency: ~339 kHz (theoretical)

.param VBUS=1000 RS=1 LVAL=55.11u CVAL=4n RLSER=0.2 RCESR=0.2
.param Fdrive=340e3 Duty=0.5 VDRV=12 Tr=10n Tf=10n
.param Tdrive={1/Fdrive}
.param T0=200u T1=380u

VBUS   NBUS_IN 0 {VBUS}
Vsense HB      NBUS_IN 0
Rs   HB  N1   {RS}
L1   N1  N2   {LVAL} Rser={RLSER}
C1   N2  SW   {CVAL} Rser={RCESR}
Vids  SW   D_M1   0
M1    D_M1 G      0  0  IRFP460
Rsnub SW 0 100
Csnub SW 0 1n
RPROBE N2 0 1Meg
Cbulk HB 0 2u Rser=0.02 Lser=5n
Vgate   VG_SRC 0 PULSE(0 {VDRV} 0 {Tr} {Tf} {Duty*Tdrive} {Tdrive})
Rgguard VG_SRC GDRV 1
Rg      GDRV   G    10
Dz      G      0    DCLAMP

.model DCLAMP D(Bv=15 Ibv=1m Rs=1 Cjo=50p M=0.3)
.model IRFP460 VDMOS Vto=4 Rds=0.25 Rd=0.2 Rs=0.05 + Cgdmax=600p Cgdmin=60p Cgs=2n Cjo=330p M=0.6 Vj=1 Tt=60n

.meas tran tper  TRIG V(N2) VAL=0 RISE=101  TARG V(N2) VAL=0 RISE=102
.meas tran f_meas   PARAM {1/tper}
.meas tran f_theory PARAM {1/(2*pi*sqrt(LVAL*CVAL))}
.meas tran Vpk_MAX MAX V(N2) FROM {T0} TO {T1}
.meas tran Ipk_L1  MAX I(L1) FROM {T0} TO {T1}
.meas tran Vds_pk  MAX V(D_M1) FROM {T0} TO {T1}
.meas tran Id_pk   MAX I(Vids) FROM {T0} TO {T1}
.meas tran Pin AVG ( (V(HB)-V(NBUS_IN)) * I(Vsense) ) FROM {T0} TO {T1}
.meas tran echo_VBUS    PARAM VBUS
.meas tran echo_LVAL    PARAM LVAL
.meas tran echo_CVAL    PARAM CVAL
.meas tran echo_RLSER   PARAM RLSER
.meas tran echo_RCESR   PARAM RCESR
.meas tran echo_Fdrive  PARAM Fdrive
.meas tran echo_VDRV    PARAM VDRV

.save all
.tran 0 300u 50u 5n
.end
    </textarea>

    <div class="row">
      <button onclick="copyNetlist()">Copy netlist</button>
      <button class="primary" onclick="openNgspiceX()">Run on ngspiceX</button>
      <a href="./Variable_Frequency_Series_Resonant_Driver_1kV_ngspiceX.cir" download>
        <button>Download .cir</button>
      </a>
    </div>

    <p class="muted">
      In ngspiceX: simply click <b>Simulate ▶</b> → choose
      traces <code>V(N2)</code>, <code>I(Vsense)</code>, <code>V(D_M1)</code>.
      Frequency and parameter values will appear in the console.
    </p>
  </section>

  <script>
    function copyNetlist() {
      const ta = document.getElementById('netlist');
      ta.select(); ta.setSelectionRange(0, ta.value.length);
      navigator.clipboard.writeText(ta.value)
        .then(() => alert('Netlist copied to clipboard.'))
        .catch(() => alert('Copy failed — please copy manually (Ctrl/Cmd+C).'));
    }

    // Opens ngspiceX with the hosted netlist pre-loaded
    function openNgspiceX() {
      const netlistURL =
        'https://raw.githubusercontent.com/ansarirahim/TOM-LC-CKT-online/main/Variable_Frequency_Series_Resonant_Driver_1kV_ngspiceX.cir';
      window.open(
        'https://shishir-dey.github.io/ngspiceX/?netlist=' + encodeURIComponent(netlistURL),
        '_blank'
      );
    }
  </script>
</body>
</html>
